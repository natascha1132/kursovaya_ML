<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Болячки лёгких</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-slate-50 min-h-screen flex flex-col items-center py-12 px-4">

    <div class="max-w-2xl w-full bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="bg-blue-600 p-8 text-white text-center">
            <i class="fa-solid fa-lungs text-5xl mb-4"></i>
            <h1 class="text-3xl font-bold">AI Анализ Легких</h1>
            <p class="mt-2 text-blue-100">Загрузите рентгеновский снимок для быстрой проверки</p>
        </div>

        <div class="p-8">
            <div id="drop-zone" class="border-2 border-dashed border-gray-300 rounded-xl p-10 text-center hover:border-blue-500 transition-colors cursor-pointer">
                <input type="file" id="fileInput" class="hidden" accept="image/*">
                <i class="fa-solid fa-cloud-arrow-up text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-600">Нажмите или перетащите файл сюда</p>
                <p class="text-xs text-gray-400 mt-2 uppercase">PNG, JPG или JPEG</p>
            </div>

            <div id="preview-container" class="hidden mt-6 text-center">
                <img id="image-preview" src="#" alt="Снимок" class="max-h-64 mx-auto rounded-lg shadow-md border">
                <button id="analyze-btn" class="mt-6 w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                    Провести анализ
                </button>
            </div>

            <div id="result-area" class="hidden mt-8 p-6 bg-blue-50 rounded-xl border border-blue-100">
                <h3 class="text-lg font-bold text-gray-800">Результат анализа:</h3>
                <p id="prediction-text" class="text-2xl font-black text-blue-700 mt-2 italic">Анализируем...</p>
                <div class="mt-4 flex items-center text-sm text-gray-500 italic">
                    <i class="fa-solid fa-circle-info mr-2"></i>
                    Данный результат получен с помощью ИИ и требует подтверждения врачом.
                </div>
            </div>
        </div>
    </div>

    <script>
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('drop-zone');
    const previewContainer = document.getElementById('preview-container');
    const imagePreview = document.getElementById('image-preview');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultArea = document.getElementById('result-area');
    const predictionText = document.getElementById('prediction-text');

    dropZone.onclick = () => fileInput.click();

    fileInput.onchange = (e) => {
        const [file] = fileInput.files;
        if (file) {
            imagePreview.src = URL.createObjectURL(file);
            previewContainer.classList.remove('hidden');
            resultArea.classList.add('hidden');
            analyzeBtn.innerText = "Провести анализ";
        }
    };

    analyzeBtn.onclick = async () => {
        if (!fileInput.files[0]) return;

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        analyzeBtn.disabled = true;
        analyzeBtn.innerText = "Нейросеть думает...";

        try {
            const response = await fetch('/predict', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            resultArea.classList.remove('hidden');
            predictionText.innerText = data.prediction;
            imagePreview.src = data.image_url + "?t=" + new Date().getTime();
            analyzeBtn.innerText = "Готово!";
        } catch (error) {
            console.error(error);
            alert("Ошибка при связи с сервером");
            analyzeBtn.innerText = "Провести анализ";
        } finally {
            analyzeBtn.disabled = false;
        }
    };
    dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('border-blue-500'); };
    dropZone.ondragleave = () => dropZone.classList.remove('border-blue-500');
    dropZone.ondrop = (e) => {
        e.preventDefault();
        fileInput.files = e.dataTransfer.files;
        fileInput.onchange();
    };
</script>
</body>
</html>